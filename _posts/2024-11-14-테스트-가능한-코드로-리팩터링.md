---
title: "í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ì½”ë“œë¡œ ë¦¬íŒ©í„°ë§"
date: "2023-03-01 23:01:56"
categories: [side, refactoring]
tags: [side, refactoring]
---

ìµœê·¼ í”„ë¡œì íŠ¸ë¥¼ ìˆ˜ì •í•˜ë©´ì„œ í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•œ ì½”ë“œì— ëŒ€í•´ ê³ ë¯¼í–ˆë‹¤. ê°‘ìê¸° ê³ ë¯¼í•œ ê²ƒì€ ì•„ë‹ˆê³  ë‚´ê°€ ì‘ì„±í•œ ì½”ë“œê°€ í…ŒìŠ¤íŠ¸í•˜ê¸° ì¢‹ì§€ì•Šë‹¤ëŠ” ê²ƒì„ ëŠê¼ˆê¸° ë•Œë¬¸ì´ë‹¤.

## ê¸°ì¡´ ì½”ë“œì˜ ë¬¸ì œì 

í”„ë¡œì íŠ¸ì— jsoupë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›¹ ì‚¬ì´íŠ¸ë¥¼ í¬ë¡¤ë§í•˜ëŠ” ê¸°ëŠ¥ì´ ìˆì—ˆë‹¤.

### ì²« ë²ˆì§¸ ë¬¸ì œì 

Jsoup ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´Â `Jsoup`Â í´ë˜ìŠ¤ì˜Â `connect`Â ìŠ¤íƒœí‹± ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ì„œ jsoup Connectionì„ ì—°ê²°í–ˆì–´ì•¼í–ˆë‹¤. ì´ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í–ˆë‹¤.

```java
    // JobSearchServiceImpl.java
    ...
    String url = "í¬ë¡¤ë§í•  URL";
    Connection connection = Jsoup.connect(url);
    Document documenet = connection.get();
    ...
```

`Document`ëŠ” urlì—ì„œ ê°€ì ¸ì˜¨ html ë¬¸ì„œê°€ ì €ì¥ë˜ëŠ” ê°ì²´ì´ë‹¤. ì´ ì½”ë“œëŠ”Â `@Service`Â ë¹ˆì— í•´ë‹¹í•˜ëŠ” ê°ì²´ì— ì‘ì„±ë˜ì—ˆìœ¼ë©°Â `Service`ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ì„œëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—­ì‹œ í…ŒìŠ¤íŠ¸í•´ì•¼í–ˆë‹¤.

`Jsoup`ì€ ë‚´ê°€ ì •ì˜í•œ ê°ì²´ê°€ ì•„ë‹ˆê¸°ë•Œë¬¸ì— ë§¤ ë²ˆ ì‹¤ì œë¡œ í¬ë¡¤ë§í•´ì˜¤ëŠ” APIì— í…ŒìŠ¤íŠ¸ì˜ ì„±ê³µì—¬ë¶€ë¥¼ ë§¡ê¸¸ ìˆœ ì—†ì—ˆë‹¤. í…ŒìŠ¤íŠ¸ë¥¼ í•  ë•Œë§ˆë‹¤ ì‹¤ì œë¡œ í¬ë¡¤ë§í•´ì™€ì•¼ í•˜ë¯€ë¡œ í…ŒìŠ¤íŠ¸ ì„±ëŠ¥ ì €í•˜ë„ ë°œìƒí–ˆë‹¤.

### ë‘ ë²ˆì§¸ ë¬¸ì œì 

ë³µì¡í•œ ë¡œì§ì„ ë©”ì„œë“œë¡œ ì¶”ì¶œí•˜ë ¤ë‹¤ë³´ë‹ˆ private ë©”ì„œë“œê°€ ë§ì´ ìƒê²¼ë‹¤.

```java
    public List<JobCrawlerDto> getSearchList(Map<String, String> searchOption, String crawlerName) throws IOException {
        ...
        method1();
        method2();
        method3();
        ...
    }
    private String method1(){
    }
    private String method2(){
    }
    private List<JobCrawler> method3(){
        method4();
    }
    private void method4();
```

ì‹¤ì œ ì½”ë“œëŠ” ì•„ë‹ˆë©°, ì´ëŸ° ì‹ìœ¼ë¡œ ì—¬ëŸ¬ ê°œì˜Â `private ë©”ì„œë“œ`ê°€ ê°ì²´ë¥¼ ì´ë£¨ê³  ìˆì—ˆë‹¤ëŠ” ê²ƒì´ë‹¤.Â `private`Â ì ‘ê·¼ì œì–´ìëŠ” í´ë˜ìŠ¤ ì™¸ë¶€ì—ì„œëŠ” ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤. í…ŒìŠ¤íŠ¸ íŒŒì¼ ì—­ì‹œ í´ë˜ìŠ¤ ì™¸ë¶€ì´ë‹¤. ì •ìƒì ì¸ ë°©ë²•ìœ¼ë¡œ private ë©”ì„œë“œë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ì—†ì—ˆë‹¤.

### ì„¸ ë²ˆì§¸ ë¬¸ì œì 

ë‚´ê°€ ì‘ì„±í•œ JobSearchService ì¸í„°í˜ì´ìŠ¤ëŠ” ë‹¤ìŒê³¼ ê°™ì€ êµ¬í˜„ì²´ë¥¼ ê°€ì§€ê³  ìˆì—ˆë‹¤.

- Service ì¸í„°í˜ì´ìŠ¤
    
    ```java
      public interface JobSearchService {
          List<JobCrawlerDto> getSearchList();
      }
    ```
    
- êµ¬ì§ì‚¬ì´íŠ¸ ë³„ Service êµ¬í˜„ì²´(í¬ë¡¤ëŸ¬)

ğŸ‘‰ ì‚¬ëŒì¸

```java
    @Service
    public class SaraminCrawler implements JobSearchService {
        @Override
        List<JobCrawlerDto> getSearchList() {J}

        private String method1(){A}
        private String method2(){B}
        private String method3(){C}
    }
```

ğŸ‘‰ ì¸í¬ë£¨íŠ¸

```java
    @Service
    public class IncruitCrawler implements JobSearchService {
        @Override
        ist<JobCrawlerDto> getSearchList() {K}

        private String method1(){D}
        private String method2(){E}
        private String method3(){F}
    }
```

ğŸ‘‰ ì¡ì½”ë¦¬ì•„

```java
    @Service
    public class JobKoreaCrawler implements JobSearchService {
        @Override
        List<JobCrawlerDto> getSearchList() {L}

        private String method1(){G}
        private String method2(){H}
        private String method3(){I}
    }
```

> ë©”ì„œë“œ ë‚´ë¥¼ ì•ŒíŒŒë²³ìœ¼ë¡œ í‘œí˜„í•œ ê²ƒì€ ëª¨ë‘ ë‹¤ë¥¸ ì½”ë“œí˜•ì‹ì´ë¼ëŠ” ì˜ë¯¸

ì„¸ ê°œì˜ ì„œë¹„ìŠ¤ êµ¬í˜„ì²´ëŠ” ë˜‘ê°™ì€ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜ë¥¼ ê°€ì¡Œì§€ë§Œ ê·¸ ì•ˆì— ë¡œì§ì€ ë‹¬ëë‹¤. ë‚˜ë¦„ ì „ëµíŒ¨í„´ìœ¼ë¡œ ìƒê°í•˜ì—¬ í•˜ë‚˜ì˜ ì¸í„°í˜ì´ìŠ¤ì— ì„œë¹„ìŠ¤ ì»´í¬ë„ŒíŠ¸ë¥¼ ì„¸ ê°œ ë‘ì—ˆë‹¤. ì—¬ê¸°ê¹Œì§„ ê·¸ëŸ´ ìˆ˜ ìˆë‹¤ê³  ìƒê°í•œë‹¤. í•˜ì§€ë§Œ ì˜¤ë²„ë¼ì´ë”© í•˜ëŠ” ë©”ì„œë“œë„ ì•„ë‹Œë° ëª¨ë‘ ë™ì¼í•œ ì‹œê·¸ë‹ˆì²˜ì˜ ë©”ì„œë“œ? ë­”ê°€ ì¤‘ë³µëœ ê²ƒ ê°™ê³  ì¢‹ì€ ì½”ë“œê°€ ì•„ë‹ˆë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.

## ë¦¬íŒ©í„°ë§

### ì²« ë²ˆì§¸ ë¬¸ì œ
ì‹¤ì œë¡œ Jsoup ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ Jsoup ê°ì²´ë¥¼ Mockingí•  í•„ìš”ê°€ ìˆì—ˆë‹¤. ì˜¬ë°”ë¥¸ Mockingì„ ìœ„í•´ Jsoup ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¸í„°í˜ì´ìŠ¤ë¡œ ê°ì‹¸ì„œ ì˜ì¡´ì„±ì„ ì£¼ì…í•´ì£¼ì—ˆë‹¤.

```java
    public interface JsoupConnection {
        Document get(String url) throws IOException;
    }
```

```java
    @Component
    public class JsoupConnectionImpl implements JsoupConnection {
        private Connection connect(String url) {
            return Jsoup.connect(url);
        }

        @Override
        public Document get(String url) throws IOException {
            Connection connect = connect(url);
            return connect.get();
    }
}
```

### [ë‘ ë²ˆì§¸ ë¬¸ì œì™€ ì„¸ ë²ˆì§¸ ë¬¸ì œ](https://nimoh.tistory.com/19#%EB%91%90%20%EB%B2%88%EC%A7%B8%20%EB%AC%B8%EC%A0%9C%EC%99%80%20%EC%84%B8%20%EB%B2%88%EC%A7%B8%20%EB%AC%B8%EC%A0%9C-1)

private ë©”ì„œë“œë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì€ ì‰¬ìš´ ì¼ì´ ì•„ë‹ˆì—ˆë‹¤. public ë©”ì„œë“œë¥¼ í…ŒìŠ¤íŠ¸í•˜ë©´ì„œ ê±°ê¸°ì— í¬í•¨ëœÂ `private ë©”ì„œë“œ`ë¥¼ ê°„ì ‘ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì´ ìµœì„ ì´ì—ˆë‹¤. private methodì— ë³„ ë‹¤ë¥¸ ì¶”ê°€ ê¸°ëŠ¥ì´ ì—†ëŠ” ìˆœìˆ˜ ìë°”ì½”ë“œì˜€ë‹¤ë©´ ì•„ë§ˆ ì´ ë°©ë²•ìœ¼ë¡œë„ ì˜ í•´ê²°ë˜ì—ˆì„ ê²ƒì´ë‹¤. í•˜ì§€ë§Œ ë‚´ ì½”ë“œëŠ” Jsoup ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ì œê³µí•˜ëŠ” ê°ì²´ì™€ ë©”ì„œë“œê°€ ë‚œë¬´í–ˆê³ , ë©”ì„œë“œì˜ ê²°ê³¼ë¡œ htmlë¬¸ì„œê°€ ë„˜ì–´ì˜¤ëŠ” ê²½ìš°ë„ ìˆì—ˆë‹¤. í…ŒìŠ¤íŠ¸í•˜ìê³  html ì½”ë“œë¥¼ ë„£ì–´ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì€ ê·¸ë¦¬ ì¢‹ì€ ë°©ë²•ê°™ì§„ ì•Šì•˜ë‹¤.

ë˜í•œ,Â `reflection`ì„ ì‚¬ìš©í•˜ë©´ ì ‘ê·¼ì œì–´ìì™€ ê´€ê³„ì—†ì´ ë©”ì„œë“œì— ì ‘ê·¼í•  ìˆ˜ ìˆì§€ë§Œ ìº¡ìŠí™”ë¥¼ ì €í•´í•˜ëŠ” ëª…ë°±í•œ ì•ˆí‹°íŒ¨í„´ì´ë¼ ìƒê°í–ˆë‹¤.

ì–´ë–»ê²Œ í•˜ë©´ ì¤‘ë³µëœÂ `private`Â ë©”ì„œë“œë“¤ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ì¢‹ì€ ì½”ë“œë¡œ ë¦¬íŒ©í„°ë§í•˜ë©´ ì¢‹ì„ê¹Œ ê³ ë¯¼í–ˆë‹¤. ë‚´ê°€ ë‚´ë¦° ê²°ë¡ ì€ '**ì±…ì„ì„ ë‚˜ëˆ„ì**' ì˜€ë‹¤.

#### JobSearchServiceì˜ ë§‰ì¤‘í•œ ì±…ì„

ê¸°ì¡´ ì½”ë“œì—ì„œ JobSearchServiceImpl ê°ì²´ëŠ” ì„œë¹„ìŠ¤ì˜ ì—­í• ê³¼ í¬ë¡¤ë§ê¹Œì§€ í•´ì•¼í•˜ëŠ” ë§‰ì¤‘í•œ ì±…ì„ì„ ë– ì•ˆì•˜ë‹¤. ê·¸ëŸ¬ë‹¤ë³´ë‹ˆ ë³¸ì¸ ë³¸ì—°ì˜ í–‰ìœ„ë„ ì•„ë‹ŒÂ `private`Â ë©”ì„œë“œê°€ ë‚œë¬´í–ˆê³ , ê·¸ ê²°ê³¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ê°€ ì—†ì—ˆë‹¤.  
ë”°ë¼ì„œÂ `JobSearchServiceImpl`ë¡œë¶€í„° í¬ë¡¤ëŸ¬ë¥¼ ë–¼ì–´ë‚¼ í•„ìš”ê°€ ìˆì—ˆë‹¤.

í¬ë¡¤ëŸ¬ ê¸°ëŠ¥ì„ ì„œë¹„ìŠ¤ì—ì„œ ë–¼ì–´ë‚´ìÂ `private`ìœ¼ë¡œ ë‚œë¬´í•˜ë˜ ë©”ì„œë“œë“¤ì€ ë‹¹ë‹¹í•˜ê²Œ í•œ ê°ì²´ì˜ ê¸°ëŠ¥ìœ¼ë¡œì„œÂ `public`ì˜ ì—­í• ì„ í•´ë‚´ê²Œë˜ì—ˆë‹¤.

- í¬ë¡¤ëŸ¬ ì¸í„°í˜ì´ìŠ¤
    
    ```java
    public interface Crawler {
      String getBaseUrl();
    
      String makeSearchListUrl(Map<String, String> searchOption);
    
      boolean checkSearchOption(Map<String, String> searchOption);
    
      boolean checkValidSortOption(String recruitSort);
    
      List<JobCrawlerDto> parseHTML(Document document);
    
      List<JobCrawlerDto> extracted(Elements itemRecruit, int resultCount);
    }
    ```
    
- í¬ë¡¤ëŸ¬ êµ¬í˜„ì²´ ì¤‘ ì‚¬ëŒì¸í¬ë¡¤ëŸ¬
    

```java
@Component
public class SaraminCrawler implements Crawler {

    final private String baseUrl = "www.saramin.co.kr";

    @Override
    public String getBaseUrl() {
        return baseUrl;
    }

    @Override
    public boolean checkSearchOption(Map<String, String> searchOption) {
        return searchOption.get("searchWord") == null || searchOption.get("recruitPage") == null || searchOption.get("recruitSort") == null;
    }

    @Override
    public boolean checkValidSortOption(String recruitSort){
        SaraminRecruitSort[] saraminRecruitSorts = SaraminRecruitSort.values();
        return Arrays.stream(saraminRecruitSorts).noneMatch(sort -> sort.getResultSort().equals(recruitSort));
    }

    @Override
    public String makeSearchListUrl(Map<String, String> searchOption){
        if(searchOption.isEmpty()) return "empty";
        return "https://" + baseUrl +"/zf_user/search/recruit?search_done=y&search_optional_item=n&company_cd=0%2C1%2C2%2C3%2C4%2C5%2C6%2C7%2C9%2C10&show_applied=&quick_apply=&except_read=&ai_head_hunting=&mainSearch=n&loc_mcd=101000&inner_com_type=&recruitPageCount=20"
                + "&searchword=" +searchOption.get("searchWord")
                + "&recruitPage=" + searchOption.get("recruitPage")
                + "&recruitSort=" + searchOption.get("recruitSort");
    }

    @Override
    public List<JobCrawlerDto> parseHTML(Document document) {
        Elements itemRecruit = document.select(".item_recruit");
        try {
            int resultCount = Integer.parseInt(document.select(".cnt_result").text().replaceAll("[^0-9]",""));
            return extracted(itemRecruit, resultCount);
        }catch (NumberFormatException ne){
            throw new CrawlerException(CrawlerErrorResult.RESULT_NOT_FOUND);
        }
    }

    @Override
    public List<JobCrawlerDto> extracted(Elements itemRecruit, int resultCount) {
       // í¬ë¡¤ë§ ë¡œì§ì´ ë„ˆë¬´ ê¸¸ì–´ì„œ ìƒëµí•©ë‹ˆë‹¤.
    }
}
```

ìœ„ì˜ ì½”ë“œê°€ ê·¸ ë™ì•ˆ ê½ê½ ê°ì¶°ì™”ë˜ private ê³¨ì¹«ë©ì´ë“¤ì´ë‹¤. ë”± ë´ë„ í…ŒìŠ¤íŠ¸í•˜ê¸° ì–´ë µê²Œ ìƒê²¼ì§€ ì•ŠëŠ”ê°€..  
ì´ë ‡ê²Œ ì„œë¹„ìŠ¤ ê°ì²´ì—ì„œ í¬ë¡¤ëŸ¬ë¥¼ ë¶„ë¦¬í•˜ë‹ˆ ì„œë¹„ìŠ¤ ê°ì²´ëŠ” ë‹¨ í•˜ë‚˜ë§Œ ì¡´ì¬í•  ìˆ˜ ìˆì—ˆìœ¼ë©° ì½”ë“œ ë˜í•œ ë§¤ìš° ê°„ë‹¨í•´ì¡Œë‹¤.

```java
@Service
public class JobSearchServiceImpl implements JobSearchService {
    private final JsoupConnection jsoupConnection;
    private final Map<String,Crawler> crawlerMap;

    @Autowired
    public JobSearchServiceImpl(JsoupConnection jsoupConnection, Map<String, Crawler> crawlerMap) {
        this.jsoupConnection = jsoupConnection;
        this.crawlerMap = crawlerMap;
    }

    @Override
    public List<JobCrawlerDto> getSearchList(Map<String, String> searchOption, String crawlerName) throws IOException {
        Crawler crawler = crawlerMap.get(crawlerName);
        if (crawler.checkSearchOption(searchOption)){
            throw new CrawlerException(CrawlerErrorResult.OPTION_NULL_EXCEPTION);
        }

        final String recruitSort = searchOption.get("recruitSort");

        if (crawler.checkValidSortOption(recruitSort)){
            throw new CrawlerException(CrawlerErrorResult.OPTION_BAD_REQUEST);
        }

        String searchList = crawler.makeSearchListUrl(searchOption);

        try {
            Document document = jsoupConnection.get(searchList);
            return crawler.parseHTML(document);
        } catch (IOException e) {
            throw new IOException("JsoupConnect Error");
        }
    }
}
```

## í…ŒìŠ¤íŠ¸í•˜ê¸° ì¢‹ì€ ì½”ë“œë€ ë¬´ì—‡ì¼ê¹Œ..

ì´ë²ˆ ê²½í—˜ì„ í†µí•´ í…ŒìŠ¤íŠ¸í•˜ê¸° ì¢‹ì€ ì½”ë“œì— ëŒ€í•´ ë§ì´ ê³ ë¯¼í–ˆë‹¤.  
ê³ ë¯¼ ëì— ë„ì¶œí•œ ì¢‹ì€ ì½”ë“œëŠ”

> **SOLID ì›ì¹™**ì„ ì§€í‚¤ë ¤ê³  ë…¸ë ¥í•˜ëŠ” ì½”ë“œì´ë‹¤.

SOLID ì›ì¹™ì— ì™„ì „ ì í•©í•œ ì½”ë“œê°€ ë¬´ì—‡ì¸ ì§€ ëª¨ë¥´ê¸°ë•Œë¬¸ì—Â _ë…¸ë ¥_ì´ë¼ëŠ” í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í–ˆë‹¤.

ì´ ì½”ë“œëŠ” SOLID ì›ì¹™ì„ ì§€í‚¤ë©´ì„œ ë¦¬íŒ©í„°ë§í•œ ê²ƒì€ ì•„ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸í•˜ê¸° ì¢‹ì€ ì½”ë“œë¡œ ë¦¬íŒ©í„°ë§í•˜ê³  ë³´ë‹ˆ SOLID ì›ì¹™ì— ê·¼ì ‘í–ˆë‹¤.

ì„œë¹„ìŠ¤Â **_ê°ì²´ì˜ ì±…ì„ì„ ë¶„í• _**í•˜ê³  (**SRP**),  
í¬ë¡¤ëŸ¬ë¥¼ ê³„ì† ì¶”ê°€í•  ìˆ˜ ìˆê²ŒÂ **_í™•ì¥ì— ì—´ë ¤ìˆìœ¼ë©°_**Â (**OCP**),  
**_í•˜ìœ„ íƒ€ì…_**(ë‹¤ì–‘í•œ êµ¬ì§ì‚¬ì´íŠ¸ í¬ë¡¤ëŸ¬)ì€Â **_ì–¸ì œë‚˜ ìƒìœ„ íƒ€ì…(Crawler)ê³¼ êµì²´_**í•  ìˆ˜ ìˆê³  (**LSP**),  
ì„œë¹„ìŠ¤Â **_ì¸í„°í˜ì´ìŠ¤ë¥¼ í¬ë¡¤ëŸ¬ì™€ ë¶„í• _**í•˜ê³  (**ISP**),  
êµ¬í˜„ì²´(`Jsoup`)ê°€ ì•„ë‹ŒÂ **_ì¸í„°í˜ì´ìŠ¤(`JsoupConnection`)ì— ì˜ì¡´_**í•˜ëŠ” (**DIP**)

ê·¸ëŸ° ì½”ë“œê°€ ë˜ì–´ ìˆì—ˆë‹¤.

ì´ë²ˆ ê²½í—˜ì„ í†µí•´ SOLIDì›ì¹™ì´ ì–´ë–»ê²Œ ë¹›ì„ ë‚´ëŠ” ì§€ ì•Œê²Œë˜ì—ˆë‹¤.  
ë§¤ ìˆœê°„ SOLIDë¥¼ ìƒê°í•˜ë©° ê°œë°œí•˜ê¸´ ì–´ë µì§€ë§Œ ì¢‹ì€ ê°ì²´ì§€í–¥ ì½”ë“œ, í…ŒìŠ¤íŠ¸í•˜ê¸° ì¢‹ì€ ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸°ìœ„í•´ ì›ì¹™ì„ ë˜ìƒˆê¸°ë©° ì‘ì„±í•´ì•¼ê² ë‹¤.